---
// Zettelkastenè¨­å®šãƒ‘ãƒãƒ«
import { DEFAULT_ZETTELKASTEN_CONFIG } from '../config';
---

<div class="settings-panel" id="settings-panel">
  <div class="settings-header">
    <h2>è¨­å®š</h2>
    <button class="close-button" id="close-settings" aria-label="é–‰ã˜ã‚‹">âœ•</button>
  </div>
  
  <div class="tabs">
    <button class="tab active" data-tab="zettelkasten">Zettelkasten</button>
    <button class="tab" data-tab="display">è¡¨ç¤ºè¨­å®š</button>
    <button class="tab" data-tab="data">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</button>
  </div>
  
  <!-- Zettelkastenè¨­å®šã‚¿ãƒ– -->
  <div class="tab-content active" id="zettelkasten-tab">
    <div class="settings-section">
      <h3>Zettelkastenãƒ¢ãƒ¼ãƒ‰</h3>
      <p>ãƒ¡ãƒ¢åŒå£«ã®ãƒªãƒ³ã‚¯ã‚’è‡ªå‹•ã§æ¤œå‡ºã—ã€ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã®ã‚ˆã†ã«åˆ©ç”¨ã§ãã¾ã™ã€‚</p>
      
      <div class="setting-item">
        <label class="switch">
          <input type="checkbox" id="zettelkasten-enabled" checked>
          <span class="slider"></span>
        </label>
        <span class="setting-label">Zettelkastenãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹</span>
      </div>
      
      <div class="sub-settings" id="zettelkasten-sub-settings">
        <div class="setting-item select-container">
          <label for="zettelkasten-mode">Zettelkastenã‚¿ã‚¤ãƒ—:</label>
          <select id="zettelkasten-mode" class="mode-select">
            <option value="standard">ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰</option>
            <option value="atomic">ã‚¢ãƒˆãƒŸãƒƒã‚¯</option>
            <option value="hierarchical">éšå±¤å‹</option>
          </select>
          <div class="description">
            <span class="mode-description" id="standard-description">
              æ¨™æº–çš„ãªZettelkastenãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚ãƒªãƒ³ã‚¯ã¨å‚ç…§ã‚’ä½¿ã£ãŸåŸºæœ¬çš„ãªãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚
            </span>
            <span class="mode-description" id="atomic-description" style="display: none;">
              æœ€å°é™ã®å†…å®¹ã‚’æŒã¤ã€Œã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒãƒ¼ãƒˆã€ã‚’ä½œæˆãƒ»ãƒªãƒ³ã‚¯ã—ã¦ã€ã‚ˆã‚ŠæŸ”è»ŸãªãƒŠãƒ¬ãƒƒã‚¸ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
            </span>
            <span class="mode-description" id="hierarchical-description" style="display: none;">
              éšå±¤æ§‹é€ ã‚’æŒã¤ãƒãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã‚«ãƒ†ã‚´ãƒªã¨ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªã«ã‚ˆã‚‹æ•´ç†ã•ã‚ŒãŸçŸ¥è­˜ä½“ç³»ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚
            </span>
          </div>
        </div>
        
        <!-- åŸºæœ¬è¨­å®š -->
        <div class="setting-group">
          <h4>åŸºæœ¬è¨­å®š</h4>
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" id="autolink-keywords" checked>
              <span class="slider"></span>
            </label>
            <span class="setting-label">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªå‹•çš„ã«ãƒªãƒ³ã‚¯ã™ã‚‹</span>
          </div>
          
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" id="highlight-bidirectional" checked>
              <span class="slider"></span>
            </label>
            <span class="setting-label">åŒæ–¹å‘ãƒªãƒ³ã‚¯ã‚’å¼·èª¿è¡¨ç¤ºã™ã‚‹</span>
          </div>
          
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" id="show-backlinks" checked>
              <span class="slider"></span>
            </label>
            <span class="setting-label">ãƒãƒƒã‚¯ãƒªãƒ³ã‚¯ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹</span>
          </div>
          
          <div class="setting-item slider-container">
            <label for="keyword-min-length" class="slider-label">
              è‡ªå‹•ãƒªãƒ³ã‚¯ã™ã‚‹æœ€å°ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é•·: <span id="keyword-length-value">3</span>
            </label>
            <input type="range" id="keyword-min-length" min="2" max="8" value="3" class="range-slider">
          </div>
        </div>
        
        <!-- æ‹¡å¼µè¨­å®š -->
        <div class="setting-group advanced-settings">
          <h4>æ‹¡å¼µè¨­å®š</h4>
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" id="markdown-links" checked>
              <span class="slider"></span>
            </label>
            <span class="setting-label">Markdownå½¢å¼ã®[[ãƒšãƒ¼ã‚¸å]]ãƒªãƒ³ã‚¯ã‚’æœ‰åŠ¹ã«ã™ã‚‹</span>
          </div>
          
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" id="context-awareness" checked>
              <span class="slider"></span>
            </label>
            <span class="setting-label">ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆèªè­˜æ©Ÿèƒ½ï¼ˆé–¢é€£ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‡ªå‹•è¡¨ç¤ºï¼‰</span>
          </div>
          
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" id="auto-suggest-links" checked>
              <span class="slider"></span>
            </label>
            <span class="setting-label">é–¢é€£ãƒªãƒ³ã‚¯ã®è‡ªå‹•ææ¡ˆ</span>
          </div>
          
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" id="tag-hierarchy" checked>
              <span class="slider"></span>
            </label>
            <span class="setting-label">ã‚¿ã‚°ã®éšå±¤æ§‹é€ ã‚’æœ‰åŠ¹ã«ã™ã‚‹</span>
          </div>
          
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" id="smart-backlinks" checked>
              <span class="slider"></span>
            </label>
            <span class="setting-label">ã‚¹ãƒãƒ¼ãƒˆãƒãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼ˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä»˜ãï¼‰</span>
          </div>
          
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" id="graph-visualization" checked>
              <span class="slider"></span>
            </label>
            <span class="setting-label">é–¢é€£ã‚°ãƒ©ãƒ•ã®è¦–è¦šåŒ–</span>
          </div>
          
          <div class="setting-item select-container">
            <label for="atomic-note-size">ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒãƒ¼ãƒˆã®ã‚µã‚¤ã‚º:</label>
            <select id="atomic-note-size" class="mode-select">
              <option value="small">å°ï¼ˆ150-250æ–‡å­—ç¨‹åº¦ï¼‰</option>
              <option value="medium" selected>ä¸­ï¼ˆ250-500æ–‡å­—ç¨‹åº¦ï¼‰</option>
              <option value="large">å¤§ï¼ˆ500-1000æ–‡å­—ç¨‹åº¦ï¼‰</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  
    <div class="live-preview">
      <h4>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
      <div class="preview-container">
        <div class="preview-mode-tag" id="preview-mode-tag">ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰</div>
        <div class="preview-sample">
          <p>ã“ã‚Œã¯<span class="sample-keyword">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</span>ã§ã™ã€‚<span class="sample-bidirectional">åŒæ–¹å‘ãƒªãƒ³ã‚¯</span>ã®ä¾‹ã‚‚è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</p>
          <p class="markdown-sample">ã“ã‚Œã¯[[MarkdownWiki]]å½¢å¼ã®ãƒªãƒ³ã‚¯ã®ä¾‹ã§ã™ã€‚</p>
          <div id="context-preview" class="context-preview">
            <p><strong>é–¢é€£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ</strong>: ã“ã®ãƒšãƒ¼ã‚¸ã¯<a href="#">æ¦‚å¿µç®¡ç†</a>ã¨<a href="#">çŸ¥è­˜ã®æ•´ç†</a>ã«é–¢é€£ã—ã¦ã„ã¾ã™ã€‚</p>
          </div>
          <div class="sample-backlinks" id="sample-backlinks">
            <h5>ãƒãƒƒã‚¯ãƒªãƒ³ã‚¯</h5>
            <ul>
              <li><a href="#" class="backlink-with-context">ã‚µãƒ³ãƒ—ãƒ«ãƒšãƒ¼ã‚¸1</a><span class="backlink-context">ã€Œ...ã“ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è©³ã—ãèª¬æ˜ã—ã¦ã„ã¾ã™...ã€</span></li>
              <li><a href="#">ã‚µãƒ³ãƒ—ãƒ«ãƒšãƒ¼ã‚¸2</a></li>
            </ul>
          </div>
          <div id="graph-preview" class="graph-preview">
            <svg width="100%" height="80" viewBox="0 0 200 80">
              <circle cx="100" cy="40" r="15" fill="#4f6df5" />
              <circle cx="40" cy="60" r="10" fill="#aaa" />
              <circle cx="160" cy="60" r="10" fill="#aaa" />
              <circle cx="70" cy="20" r="10" fill="#aaa" />
              <circle cx="130" cy="20" r="10" fill="#aaa" />
              <line x1="100" y1="40" x2="40" y2="60" stroke="#999" stroke-width="1" />
              <line x1="100" y1="40" x2="160" y2="60" stroke="#999" stroke-width="1" />
              <line x1="100" y1="40" x2="70" y2="20" stroke="#0a0" stroke-width="2" />
              <line x1="100" y1="40" x2="130" y2="20" stroke="#999" stroke-width="1" />
            </svg>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- è¡¨ç¤ºè¨­å®šã‚¿ãƒ– -->
  <div class="tab-content" id="display-tab">
    <div class="settings-section">
      <h3>ãƒ†ãƒ¼ãƒè¨­å®š</h3>
      <div class="setting-item select-container">
        <label for="theme-mode">è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰:</label>
        <select id="theme-mode" class="mode-select">
          <option value="light">ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰</option>
          <option value="dark">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</option>
          <option value="auto">è‡ªå‹•ï¼ˆã‚·ã‚¹ãƒ†ãƒ è¨­å®šã«åˆã‚ã›ã‚‹ï¼‰</option>
        </select>
        <div class="description">
          è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€å³åº§ã«ã‚µã‚¤ãƒˆå…¨ä½“ã®è¦‹ãŸç›®ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚
        </div>
      </div>
      
      <div class="setting-item select-container">
        <label for="font-size">ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º:</label>
        <select id="font-size" class="mode-select">
          <option value="small">å°</option>
          <option value="medium" selected>ä¸­</option>
          <option value="large">å¤§</option>
        </select>
      </div>
      
      <div class="setting-item">
        <label class="switch">
          <input type="checkbox" id="show-toc" checked>
          <span class="slider"></span>
        </label>
        <span class="setting-label">ç›®æ¬¡ã‚’è¡¨ç¤ºã™ã‚‹</span>
      </div>
    </div>
    
    <div class="theme-preview">
      <h4>ãƒ†ãƒ¼ãƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
      <div class="theme-cards">
        <div class="theme-card light-theme" id="light-theme-preview">
          <div class="theme-header">ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰</div>
          <div class="theme-content">
            <p>æ˜ã‚‹ã„èƒŒæ™¯ã«æš—ã„ãƒ†ã‚­ã‚¹ãƒˆ</p>
            <div class="theme-samples">
              <div class="sample-button primary">ãƒœã‚¿ãƒ³</div>
              <div class="sample-link">ãƒªãƒ³ã‚¯</div>
            </div>
          </div>
        </div>
        
        <div class="theme-card dark-theme" id="dark-theme-preview">
          <div class="theme-header">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</div>
          <div class="theme-content">
            <p>æš—ã„èƒŒæ™¯ã«æ˜ã‚‹ã„ãƒ†ã‚­ã‚¹ãƒˆ</p>
            <div class="theme-samples">
              <div class="sample-button primary">ãƒœã‚¿ãƒ³</div>
              <div class="sample-link">ãƒªãƒ³ã‚¯</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¿ãƒ– -->
  <div class="tab-content" id="data-tab">
    <div class="settings-section">
      <h3>ãƒ‡ãƒ¼ã‚¿ç®¡ç†è¨­å®š</h3>
      <p>ãƒ‡ãƒ¼ã‚¿ç®¡ç†æ©Ÿèƒ½ã«é–¢é€£ã™ã‚‹è¨­å®šã§ã™ã€‚</p>
      
      <div class="quick-access-links">
        <a href="/starlight-issue-wiki/data-management" class="quick-link">
          <span class="quick-link-icon">ğŸ“¤</span>
          <span class="quick-link-text">ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒšãƒ¼ã‚¸ã¸</span>
        </a>
      </div>
      
      <div class="setting-item">
        <label class="switch">
          <input type="checkbox" id="auto-backup" checked>
          <span class="slider"></span>
        </label>
        <span class="setting-label">è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’æœ‰åŠ¹ã«ã™ã‚‹</span>
      </div>
      
      <div class="setting-item select-container">
        <label for="backup-frequency">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é »åº¦:</label>
        <select id="backup-frequency" class="mode-select">
          <option value="daily">æ¯æ—¥</option>
          <option value="weekly" selected>æ¯é€±</option>
          <option value="monthly">æ¯æœˆ</option>
        </select>
      </div>
    </div>
  </div>
  
  <div class="settings-footer">
    <button class="save-button" id="save-settings">è¨­å®šã‚’ä¿å­˜</button>
    <button class="reset-button" id="reset-settings">åˆæœŸå€¤ã«æˆ»ã™</button>
  </div>
</div>

<style>
  .settings-panel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 650px;
    background-color: white;
    border-radius: 0.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    padding: 1.5rem;
    z-index: 1000;
    display: none;
    max-height: 90vh;
    overflow-y: auto;
  }
  
  .dark .settings-panel {
    background-color: #222;
    color: #eee;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
  }
  
  .settings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }
  
  .tabs {
    display: flex;
    border-bottom: 1px solid #eee;
    margin-bottom: 1.5rem;
  }
  
  .dark .tabs {
    border-bottom-color: #444;
  }
  
  .tab {
    padding: 0.75rem 1.5rem;
    background: transparent;
    border: none;
    cursor: pointer;
    color: #666;
    border-bottom: 3px solid transparent;
    transition: all 0.2s;
  }
  
  .dark .tab {
    color: #aaa;
  }
  
  .tab:hover {
    color: #333;
    background-color: #f9f9f9;
  }
  
  .dark .tab:hover {
    color: #eee;
    background-color: #333;
  }
  
  .tab.active {
    color: var(--color-primary, #4f6df5);
    border-bottom-color: var(--color-primary, #4f6df5);
    font-weight: 500;
  }
  
  .tab-content {
    display: none;
  }
  
  .tab-content.active {
    display: block;
  }
  
  .settings-header h2 {
    margin: 0;
    font-size: 1.5rem;
  }
  
  .close-button {
    background: none;
    border: none;
    font-size: 1.2rem;
    cursor: pointer;
    color: #666;
  }
  
  .dark .close-button {
    color: #aaa;
  }
  
  .close-button:hover {
    color: #333;
  }
  
  .dark .close-button:hover {
    color: #fff;
  }
  
  .settings-section {
    margin-bottom: 1.5rem;
  }
  
  .settings-section h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.2rem;
  }
  
  .settings-section p {
    color: #666;
    margin: 0 0 1rem 0;
    font-size: 0.9rem;
  }
  
  .dark .settings-section p {
    color: #aaa;
  }
  
  .setting-item {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
  }
  
  .setting-label {
    margin-left: 1rem;
  }
  
  .setting-group {
    margin-bottom: 1.5rem;
    padding: 1rem;
    background-color: #f9f9f9;
    border-radius: 0.5rem;
  }
  
  .dark .setting-group {
    background-color: #2a2a2a;
  }
  
  .setting-group h4 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 1rem;
    color: #333;
    border-bottom: 1px solid #eee;
    padding-bottom: 0.5rem;
  }
  
  .dark .setting-group h4 {
    color: #ddd;
    border-bottom-color: #444;
  }
  
  .advanced-settings {
    border-left: 3px solid var(--color-primary, #4f6df5);
  }
  
  .sub-settings {
    margin-left: 1.5rem;
    margin-top: 1rem;
    padding-left: 1rem;
    border-left: 2px solid #eee;
  }
  
  .dark .sub-settings {
    border-left-color: #444;
  }
  
  .select-container {
    display: flex;
    flex-direction: column;
  }
  
  .select-container label {
    margin-bottom: 0.5rem;
  }
  
  .mode-select {
    padding: 0.5rem;
    border-radius: 0.25rem;
    border: 1px solid #ddd;
    background-color: white;
    margin-bottom: 0.5rem;
  }
  
  .dark .mode-select {
    background-color: #333;
    border-color: #555;
    color: #eee;
  }
  
  .description {
    font-size: 0.85rem;
    color: #666;
    margin-top: 0.25rem;
    font-style: italic;
  }
  
  .dark .description {
    color: #aaa;
  }
  
  /* ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
  .live-preview {
    margin: 1.5rem 0;
    padding: 1rem;
    border: 1px solid #eee;
    border-radius: 0.5rem;
    background-color: #f9f9f9;
  }
  
  .dark .live-preview {
    border-color: #444;
    background-color: #1a1a1a;
  }
  
  .live-preview h4 {
    margin-top: 0;
    margin-bottom: 0.5rem;
    font-size: 1rem;
  }
  
  .preview-container {
    padding: 1rem;
    background-color: white;
    border-radius: 0.25rem;
    border: 1px solid #eee;
    position: relative;
  }
  
  .dark .preview-container {
    background-color: #222;
    border-color: #333;
  }
  
  .preview-mode-tag {
    position: absolute;
    top: -10px;
    right: 10px;
    background-color: var(--color-primary, #4f6df5);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 500;
  }
  
  .sample-keyword {
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .sample-bidirectional {
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .markdown-sample {
    margin: 0.5rem 0;
  }
  
  .context-preview {
    margin: 1rem 0;
    padding: 0.5rem;
    background-color: #f0f7ff;
    border-radius: 0.25rem;
    font-size: 0.9rem;
  }
  
  .dark .context-preview {
    background-color: #1a2942;
  }
  
  .sample-backlinks {
    margin-top: 1rem;
    padding-top: 0.5rem;
    border-top: 1px solid #eee;
    font-size: 0.9rem;
  }
  
  .dark .sample-backlinks {
    border-top-color: #444;
  }
  
  .sample-backlinks h5 {
    margin-top: 0;
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
  }
  
  .sample-backlinks h5::after {
    content: "2";
    display: inline-block;
    background-color: #f0f0f0;
    color: #555;
    padding: 0.1rem 0.4rem;
    border-radius: 1rem;
    font-size: 0.8rem;
    font-weight: 600;
    margin-left: 0.5rem;
  }
  
  .dark .sample-backlinks h5::after {
    background-color: #333;
    color: #ccc;
  }
  
  .sample-backlinks ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .sample-backlinks li {
    margin-bottom: 0.25rem;
    position: relative;
  }
  
  .sample-backlinks a {
    display: block;
    padding: 0.25rem 0.5rem;
    text-decoration: none;
    border-radius: 0.25rem;
    transition: background-color 0.2s;
  }
  
  .sample-backlinks a:hover {
    background-color: #f5f5f5;
  }
  
  .dark .sample-backlinks a:hover {
    background-color: #333;
  }
  
  .backlink-with-context {
    color: var(--color-primary, #4f6df5);
  }
  
  .backlink-context {
    display: block;
    padding-left: 1.5rem;
    font-size: 0.85rem;
    color: #777;
    font-style: italic;
  }
  
  .dark .backlink-context {
    color: #999;
  }
  
  .graph-preview {
    margin-top: 1rem;
    padding-top: 0.5rem;
    border-top: 1px solid #eee;
  }
  
  .dark .graph-preview {
    border-top-color: #444;
  }
  
  .dark .graph-preview svg circle {
    stroke: #444;
  }
  
  .dark .graph-preview svg line {
    stroke-opacity: 0.6;
  }
  
  /* ãƒ†ãƒ¼ãƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
  .theme-preview {
    margin: 1.5rem 0;
    padding: 1rem;
    border: 1px solid #eee;
    border-radius: 0.5rem;
    background-color: #f9f9f9;
  }
  
  .dark .theme-preview {
    border-color: #444;
    background-color: #1a1a1a;
  }
  
  .theme-preview h4 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 1rem;
  }
  
  .theme-cards {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }
  
  .theme-card {
    flex: 1;
    min-width: 200px;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .light-theme {
    background-color: white;
    color: #333;
  }
  
  .dark-theme {
    background-color: #222;
    color: #eee;
  }
  
  .theme-header {
    padding: 0.75rem;
    font-weight: 500;
    text-align: center;
    border-bottom: 1px solid #eee;
  }
  
  .dark-theme .theme-header {
    border-bottom-color: #444;
  }
  
  .theme-content {
    padding: 1rem;
  }
  
  .theme-samples {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }
  
  .sample-button {
    padding: 0.5rem 0.75rem;
    border-radius: 0.25rem;
    font-size: 0.85rem;
    cursor: pointer;
  }
  
  .sample-button.primary {
    background-color: var(--color-primary, #4f6df5);
    color: white;
  }
  
  .sample-link {
    color: var(--color-primary, #4f6df5);
    text-decoration: underline;
    cursor: pointer;
    font-size: 0.85rem;
    padding: 0.5rem 0;
  }
  
  /* ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .switch {
    position: relative;
    display: inline-block;
    width: 48px;
    height: 24px;
    flex-shrink: 0;
  }
  
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
  }
  
  .slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
  }
  
  input:checked + .slider {
    background-color: var(--color-primary);
  }
  
  input:focus + .slider {
    box-shadow: 0 0 1px var(--color-primary);
  }
  
  input:checked + .slider:before {
    transform: translateX(24px);
  }
  
  /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .slider-container {
    flex-direction: column;
    align-items: stretch;
  }
  
  .slider-label {
    margin-bottom: 0.5rem;
    width: 100%;
  }
  
  .range-slider {
    -webkit-appearance: none;
    width: 100%;
    height: 8px;
    border-radius: 5px;
    background: #d3d3d3;
    outline: none;
  }
  
  .range-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--color-primary);
    cursor: pointer;
  }
  
  .range-slider::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--color-primary);
    cursor: pointer;
  }
  
  /* ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ³ã‚¯ */
  .quick-access-links {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  
  .quick-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background-color: #f0f0f0;
    border-radius: 0.5rem;
    text-decoration: none;
    color: #333;
    transition: all 0.2s;
  }
  
  .dark .quick-link {
    background-color: #333;
    color: #eee;
  }
  
  .quick-link:hover {
    background-color: #e8e8e8;
    transform: translateY(-2px);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
  }
  
  .dark .quick-link:hover {
    background-color: #444;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
  }
  
  .quick-link-icon {
    font-size: 1.2rem;
  }
  
  /* ãƒ•ãƒƒã‚¿ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .settings-footer {
    display: flex;
    justify-content: space-between;
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid #eee;
  }
  
  .dark .settings-footer {
    border-top-color: #444;
  }
  
  .save-button, .reset-button {
    padding: 0.5rem 1rem;
    border-radius: 0.25rem;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s;
  }
  
  .save-button {
    background-color: var(--color-primary);
    color: white;
    border: none;
  }
  
  .save-button:hover {
    background-color: var(--color-primary-dark, #4a5fdd);
  }
  
  .reset-button {
    background-color: transparent;
    color: #666;
    border: 1px solid #ccc;
  }
  
  .dark .reset-button {
    color: #ccc;
    border-color: #555;
  }
  
  .reset-button:hover {
    background-color: #f5f5f5;
    color: #333;
  }
  
  .dark .reset-button:hover {
    background-color: #333;
    color: #eee;
  }
  
  /* ä¿å­˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .save-message {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    background-color: #4CAF50;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 0.25rem;
    font-weight: 500;
    z-index: 1001;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    animation: fadeIn 0.3s, fadeOut 0.3s 1.7s;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translate(-50%, 20px); }
    to { opacity: 1; transform: translate(-50%, 0); }
  }
  
  @keyframes fadeOut {
    from { opacity: 1; transform: translate(-50%, 0); }
    to { opacity: 0; transform: translate(-50%, 20px); }
  }
  
  /* ãƒ¢ãƒã‚¤ãƒ«å‘ã‘èª¿æ•´ */
  @media (max-width: 640px) {
    .settings-panel {
      width: 95%;
      padding: 1rem;
    }
    
    .tabs {
      overflow-x: auto;
    }
    
    .tab {
      padding: 0.75rem 0.75rem;
      white-space: nowrap;
    }
    
    .theme-cards {
      flex-direction: column;
    }
  }
</style>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const settingsPanel = document.getElementById('settings-panel');
    const closeButton = document.getElementById('close-settings');
    const saveButton = document.getElementById('save-settings');
    const resetButton = document.getElementById('reset-settings');
    
    // ã‚¿ãƒ–ç®¡ç†
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        tab.classList.add('active');
        document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
      });
    });
    
    // è¨­å®šãƒ•ã‚©ãƒ¼ãƒ è¦ç´  - Zettelkasten
    const zettelkastenEnabled = document.getElementById('zettelkasten-enabled');
    const zettelkastenMode = document.getElementById('zettelkasten-mode');
    const autolinkKeywords = document.getElementById('autolink-keywords');
    const highlightBidirectional = document.getElementById('highlight-bidirectional');
    const showBacklinks = document.getElementById('show-backlinks');
    const keywordMinLength = document.getElementById('keyword-min-length');
    const keywordLengthValue = document.getElementById('keyword-length-value');
    const subSettings = document.getElementById('zettelkasten-sub-settings');
    
    // æ‹¡å¼µè¨­å®š
    const markdownLinks = document.getElementById('markdown-links');
    const contextAwareness = document.getElementById('context-awareness');
    const atomicNoteSize = document.getElementById('atomic-note-size');
    const autoSuggestLinks = document.getElementById('auto-suggest-links');
    const tagHierarchy = document.getElementById('tag-hierarchy');
    const smartBacklinks = document.getElementById('smart-backlinks');
    const graphVisualization = document.getElementById('graph-visualization');
    
    // è¡¨ç¤ºè¨­å®š
    const themeMode = document.getElementById('theme-mode');
    const fontSize = document.getElementById('font-size');
    const showToc = document.getElementById('show-toc');
    
    // ãƒ‡ãƒ¼ã‚¿ç®¡ç†è¨­å®š
    const autoBackup = document.getElementById('auto-backup');
    const backupFrequency = document.getElementById('backup-frequency');
    
    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦ç´ 
    const previewModeTag = document.getElementById('preview-mode-tag');
    const sampleKeyword = document.querySelector('.sample-keyword');
    const sampleBidirectional = document.querySelector('.sample-bidirectional');
    const markdownSample = document.querySelector('.markdown-sample');
    const contextPreview = document.getElementById('context-preview');
    const sampleBacklinks = document.getElementById('sample-backlinks');
    const graphPreview = document.getElementById('graph-preview');
    
    // ãƒ¢ãƒ¼ãƒ‰èª¬æ˜
    const modeDescriptions = {
      standard: document.getElementById('standard-description'),
      atomic: document.getElementById('atomic-description'),
      hierarchical: document.getElementById('hierarchical-description')
    };
    
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
    const defaultConfig = {
      // Zettelkasten
      enabled: true,
      visualMode: 'standard',
      autoLinkKeywords: true,
      highlightBidirectional: true,
      showBacklinks: true,
      keywordMinLength: 3,
      markdownLinks: true,
      contextAwareness: true,
      atomicNoteSize: 'medium',
      autoSuggestLinks: true,
      tagHierarchy: true,
      smartBacklinks: true,
      graphVisualization: true,
      
      // è¡¨ç¤ºè¨­å®š
      themeMode: 'auto',
      fontSize: 'medium',
      showToc: true,
      
      // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
      autoBackup: true,
      backupFrequency: 'weekly'
    };
    
    // ZettelkastenModeã«å¿œã˜ãŸUIæ›´æ–°
    zettelkastenMode.addEventListener('change', () => {
      const mode = zettelkastenMode.value;
      
      // ãƒ¢ãƒ¼ãƒ‰èª¬æ˜ã‚’æ›´æ–°
      Object.keys(modeDescriptions).forEach(key => {
        modeDescriptions[key].style.display = key === mode ? 'block' : 'none';
      });
      
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚¿ã‚°ã‚’æ›´æ–°
      previewModeTag.textContent = ({
        'standard': 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰',
        'atomic': 'ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰',
        'hierarchical': 'éšå±¤å‹ãƒ¢ãƒ¼ãƒ‰'
      })[mode];
      
      updatePreview();
    });
    
    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updatePreview() {
      // æœ‰åŠ¹/ç„¡åŠ¹çŠ¶æ…‹
      if (zettelkastenEnabled.checked) {
        // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸè¦‹ãŸç›®ã®å¤‰æ›´
        const mode = zettelkastenMode.value;
        
        // è‡ªå‹•ãƒªãƒ³ã‚¯ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰
        if (autolinkKeywords.checked) {
          sampleKeyword.style.textDecoration = 'none';
          sampleKeyword.style.borderBottom = '1px dashed var(--color-primary, #4f6df5)';
          sampleKeyword.style.color = 'var(--color-primary, #4f6df5)';
        } else {
          sampleKeyword.style.textDecoration = 'none';
          sampleKeyword.style.borderBottom = 'none';
          sampleKeyword.style.color = 'inherit';
        }
        
        // åŒæ–¹å‘ãƒªãƒ³ã‚¯ã®å¼·èª¿è¡¨ç¤º
        if (highlightBidirectional.checked) {
          sampleBidirectional.style.textDecoration = 'none';
          sampleBidirectional.style.borderBottom = '2px solid var(--color-success, #0fa968)';
          sampleBidirectional.style.color = 'var(--color-success, #0fa968)';
          sampleBidirectional.style.fontWeight = '500';
        } else {
          sampleBidirectional.style.textDecoration = 'none';
          sampleBidirectional.style.borderBottom = '1px dashed var(--color-primary, #4f6df5)';
          sampleBidirectional.style.color = 'var(--color-primary, #4f6df5)';
          sampleBidirectional.style.fontWeight = 'normal';
        }
        
        // Markdownå½¢å¼ãƒªãƒ³ã‚¯
        markdownSample.style.display = markdownLinks.checked ? 'block' : 'none';
        
        // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆèªè­˜
        contextPreview.style.display = contextAwareness.checked ? 'block' : 'none';
        
        // ã‚¹ãƒãƒ¼ãƒˆãƒãƒƒã‚¯ãƒªãƒ³ã‚¯
        const backlinkContext = document.querySelector('.backlink-context');
        if (backlinkContext) {
          backlinkContext.style.display = smartBacklinks.checked ? 'block' : 'none';
        }
        
        // ãƒãƒƒã‚¯ãƒªãƒ³ã‚¯ã®è¡¨ç¤º
        sampleBacklinks.style.display = showBacklinks.checked ? 'block' : 'none';
        
        // ã‚°ãƒ©ãƒ•ã®è¡¨ç¤º
        graphPreview.style.display = graphVisualization.checked ? 'block' : 'none';
        
        // ãƒ¢ãƒ¼ãƒ‰å›ºæœ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«
        if (mode === 'atomic') {
          document.querySelector('.preview-sample').style.padding = '0.5rem';
          document.querySelector('.preview-sample').style.border = '1px solid #eee';
          document.querySelector('.preview-sample').style.borderRadius = '0.25rem';
          document.querySelector('.preview-sample').style.backgroundColor = '#fafafa';
        } else if (mode === 'hierarchical') {
          document.querySelector('.preview-sample').style.paddingLeft = '1rem';
          document.querySelector('.preview-sample').style.borderLeft = '3px solid var(--color-primary, #4f6df5)';
        } else {
          // ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰
          document.querySelector('.preview-sample').style.padding = '0';
          document.querySelector('.preview-sample').style.border = 'none';
          document.querySelector('.preview-sample').style.borderRadius = '0';
          document.querySelector('.preview-sample').style.backgroundColor = 'transparent';
          document.querySelector('.preview-sample').style.borderLeft = 'none';
        }
      } else {
        // Zettelkastenãƒ¢ãƒ¼ãƒ‰ãŒç„¡åŠ¹ã®å ´åˆ
        sampleKeyword.style.textDecoration = 'none';
        sampleKeyword.style.borderBottom = 'none';
        sampleKeyword.style.color = 'inherit';
        sampleBidirectional.style.textDecoration = 'none';
        sampleBidirectional.style.borderBottom = 'none';
        sampleBidirectional.style.color = 'inherit';
        sampleBidirectional.style.fontWeight = 'normal';
        sampleBacklinks.style.display = 'none';
        markdownSample.style.display = 'none';
        contextPreview.style.display = 'none';
        graphPreview.style.display = 'none';
        document.querySelector('.preview-sample').style.padding = '0';
        document.querySelector('.preview-sample').style.border = 'none';
        document.querySelector('.preview-sample').style.backgroundColor = 'transparent';
      }
    }

    // ãƒ†ãƒ¼ãƒè¨­å®šå¤‰æ›´å‡¦ç†
    if (themeMode) {
      themeMode.addEventListener('change', (e) => {
        const selectedMode = e.target.value;
        // ãƒ†ãƒ¼ãƒãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãƒ†ãƒ¼ãƒã‚’è¨­å®š
        if (window.themeManager) {
          window.themeManager.setTheme(selectedMode);
        } else {
          // ãƒ†ãƒ¼ãƒãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ãƒ­ãƒ¼ãƒ‰ã‚’è©¦ã¿ã‚‹
          loadThemeManager().then(() => {
            if (window.themeManager) {
              window.themeManager.setTheme(selectedMode);
            }
          });
        }
      });
    }

    // ãƒ†ãƒ¼ãƒãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ãƒ­ãƒ¼ãƒ‰
    async function loadThemeManager() {
      if (window.themeManager) return;
      
      try {
        // ä¿®æ­£: æ­£ã—ã„ãƒ‘ã‚¹ã‚’ä½¿ç”¨ã—ã¦themeManager.jsã‚’import
        const themeModule = await import('/starlight-issue-wiki/utils/themeManager.js');
        window.themeManager = themeModule;
        
        // ç¾åœ¨ã®ãƒ†ãƒ¼ãƒã‚’å–å¾—ã—ã¦ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«è¨­å®š
        if (themeMode) {
          const currentThemePreference = themeModule.getSavedThemePreference();
          themeMode.value = currentThemePreference;
        }
      } catch (error) {
        console.error('ãƒ†ãƒ¼ãƒãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
      }
    }
    
    // è¨­å®šãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
    if (closeButton) {
      closeButton.addEventListener('click', () => {
        settingsPanel.style.display = 'none';
      });
    }
    
    // ã‚µãƒ–è¨­å®šã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
    if (zettelkastenEnabled && subSettings) {
      zettelkastenEnabled.addEventListener('change', () => {
        subSettings.style.display = zettelkastenEnabled.checked ? 'block' : 'none';
        updatePreview();
      });
    }
    
    // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ã‚’è¡¨ç¤º
    if (keywordMinLength && keywordLengthValue) {
      keywordMinLength.addEventListener('input', () => {
        keywordLengthValue.textContent = keywordMinLength.value;
      });
    }
    
    // å„è¨­å®šå¤‰æ›´æ™‚ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
    [
      autolinkKeywords, highlightBidirectional, showBacklinks, 
      markdownLinks, contextAwareness, atomicNoteSize, 
      autoSuggestLinks, tagHierarchy, smartBacklinks, graphVisualization
    ].forEach(input => {
      if (input) input.addEventListener('change', updatePreview);
    });
    
    // è¨­å®šã‚’ä¿å­˜
    if (saveButton) {
      saveButton.addEventListener('click', () => {
        saveSettings();
        settingsPanel.style.display = 'none';
        
        // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å¯¾ã—ã¦Zettelkastenã®è¨­å®šã‚’å³æ™‚é©ç”¨
        applySettingsToCurrentPage();
      });
    }
    
    // è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ
    if (resetButton) {
      resetButton.addEventListener('click', () => {
        resetSettings();
        updatePreview();
      });
    }
    
    // è¨­å®šã‚’èª­ã¿è¾¼ã¿
    function loadSettings() {
      try {
        let config = defaultConfig;
        const savedConfig = localStorage.getItem('zettelkastenConfig');
        
        if (savedConfig) {
          config = JSON.parse(savedConfig);
        }
        
        // Zettelkastenè¨­å®š
        zettelkastenEnabled.checked = config.enabled;
        if (zettelkastenMode) zettelkastenMode.value = config.visualMode || 'standard';
        autolinkKeywords.checked = config.autoLinkKeywords;
        highlightBidirectional.checked = config.highlightBidirectional;
        showBacklinks.checked = config.showBacklinks;
        keywordMinLength.value = config.keywordMinLength;
        keywordLengthValue.textContent = config.keywordMinLength;
        
        // æ‹¡å¼µè¨­å®š
        if (markdownLinks) markdownLinks.checked = config.markdownLinks !== undefined ? config.markdownLinks : true;
        if (contextAwareness) contextAwareness.checked = config.contextAwareness !== undefined ? config.contextAwareness : true;
        if (atomicNoteSize) atomicNoteSize.value = config.atomicNoteSize || 'medium';
        if (autoSuggestLinks) autoSuggestLinks.checked = config.autoSuggestLinks !== undefined ? config.autoSuggestLinks : true;
        if (tagHierarchy) tagHierarchy.checked = config.tagHierarchy !== undefined ? config.tagHierarchy : true;
        if (smartBacklinks) smartBacklinks.checked = config.smartBacklinks !== undefined ? config.smartBacklinks : true;
        if (graphVisualization) graphVisualization.checked = config.graphVisualization !== undefined ? config.graphVisualization : true;
        
        // è¡¨ç¤ºè¨­å®š
        if (themeMode) {
          // ç¾åœ¨ã®ãƒ†ãƒ¼ãƒè¨­å®šã‚’èª­ã¿è¾¼ã‚€
          loadThemeManager().then(() => {
            if (window.themeManager) {
              themeMode.value = window.themeManager.getSavedThemePreference();
            } else {
              themeMode.value = config.themeMode || 'auto';
            }
          });
        }
        
        if (fontSize) fontSize.value = config.fontSize || 'medium';
        if (showToc) showToc.checked = config.showToc !== undefined ? config.showToc : true;
        
        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†è¨­å®š
        if (autoBackup) autoBackup.checked = config.autoBackup !== undefined ? config.autoBackup : true;
        if (backupFrequency) backupFrequency.value = config.backupFrequency || 'weekly';
        
        // ãƒ¢ãƒ¼ãƒ‰èª¬æ˜ã‚’æ›´æ–°
        if (modeDescriptions) {
          Object.keys(modeDescriptions).forEach(key => {
            if (modeDescriptions[key]) {
              modeDescriptions[key].style.display = key === (config.visualMode || 'standard') ? 'block' : 'none';
            }
          });
        }
        
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚¿ã‚°ã‚’æ›´æ–°
        if (previewModeTag) {
          previewModeTag.textContent = ({
            'standard': 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰',
            'atomic': 'ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰',
            'hierarchical': 'éšå±¤å‹ãƒ¢ãƒ¼ãƒ‰'
          })[config.visualMode || 'standard'];
        }
        
        subSettings.style.display = config.enabled ? 'block' : 'none';
        
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
        updatePreview();
        
        console.log('Loaded Zettelkasten config:', config);
      } catch (error) {
        console.error('è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
      }
    }
    
    // è¨­å®šã‚’ä¿å­˜
    function saveSettings() {
      try {
        const config = {
          // Zettelkastenè¨­å®š
          enabled: zettelkastenEnabled.checked,
          visualMode: zettelkastenMode.value,
          autoLinkKeywords: autolinkKeywords.checked,
          highlightBidirectional: highlightBidirectional.checked,
          showBacklinks: showBacklinks.checked,
          keywordMinLength: parseInt(keywordMinLength.value, 10),
          
          // æ‹¡å¼µè¨­å®š
          markdownLinks: markdownLinks.checked,
          contextAwareness: contextAwareness.checked,
          atomicNoteSize: atomicNoteSize.value,
          autoSuggestLinks: autoSuggestLinks.checked,
          tagHierarchy: tagHierarchy.checked,
          smartBacklinks: smartBacklinks.checked,
          graphVisualization: graphVisualization.checked,
          
          // è¡¨ç¤ºè¨­å®š
          themeMode: themeMode.value,
          fontSize: fontSize.value,
          showToc: showToc.checked,
          
          // ãƒ‡ãƒ¼ã‚¿ç®¡ç†è¨­å®š
          autoBackup: autoBackup.checked,
          backupFrequency: backupFrequency.value
        };
        
        localStorage.setItem('zettelkastenConfig', JSON.stringify(config));
        console.log('Saved Zettelkasten config:', config);
        
        // ãƒ†ãƒ¼ãƒè¨­å®šã‚’é©ç”¨
        if (window.themeManager) {
          window.themeManager.setTheme(config.themeMode);
        }
        
        // ä¿å­˜æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        const saveMessage = document.createElement('div');
        saveMessage.className = 'save-message';
        saveMessage.textContent = 'è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ';
        document.body.appendChild(saveMessage);
        
        setTimeout(() => {
          saveMessage.remove();
        }, 2000);
        
        // è¨­å®šå¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
        window.dispatchEvent(new CustomEvent('zettelkasten-settings-changed', { detail: config }));
      } catch (error) {
        console.error('è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
      }
    }
    
    // è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ
    function resetSettings() {
      // Zettelkastenè¨­å®š
      zettelkastenEnabled.checked = defaultConfig.enabled;
      zettelkastenMode.value = defaultConfig.visualMode;
      autolinkKeywords.checked = defaultConfig.autoLinkKeywords;
      highlightBidirectional.checked = defaultConfig.highlightBidirectional;
      showBacklinks.checked = defaultConfig.showBacklinks;
      keywordMinLength.value = defaultConfig.keywordMinLength;
      keywordLengthValue.textContent = defaultConfig.keywordMinLength;
      
      // æ‹¡å¼µè¨­å®š
      markdownLinks.checked = defaultConfig.markdownLinks;
      contextAwareness.checked = defaultConfig.contextAwareness;
      atomicNoteSize.value = defaultConfig.atomicNoteSize;
      autoSuggestLinks.checked = defaultConfig.autoSuggestLinks;
      tagHierarchy.checked = defaultConfig.tagHierarchy;
      smartBacklinks.checked = defaultConfig.smartBacklinks;
      graphVisualization.checked = defaultConfig.graphVisualization;
      
      // è¡¨ç¤ºè¨­å®š
      themeMode.value = defaultConfig.themeMode;
      fontSize.value = defaultConfig.fontSize;
      showToc.checked = defaultConfig.showToc;
      
      // ãƒ‡ãƒ¼ã‚¿ç®¡ç†è¨­å®š
      autoBackup.checked = defaultConfig.autoBackup;
      backupFrequency.value = defaultConfig.backupFrequency;
      
      // ãƒ¢ãƒ¼ãƒ‰èª¬æ˜ã‚’æ›´æ–°
      Object.keys(modeDescriptions).forEach(key => {
        modeDescriptions[key].style.display = key === defaultConfig.visualMode ? 'block' : 'none';
      });
      
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚¿ã‚°ã‚’æ›´æ–°
      previewModeTag.textContent = ({
        'standard': 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰',
        'atomic': 'ã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰',
        'hierarchical': 'éšå±¤å‹ãƒ¢ãƒ¼ãƒ‰'
      })[defaultConfig.visualMode];
      
      subSettings.style.display = defaultConfig.enabled ? 'block' : 'none';
      
      // ãƒ†ãƒ¼ãƒè¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ
      if (window.themeManager) {
        window.themeManager.setTheme(defaultConfig.themeMode);
      }
    }
    
    // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã«è¨­å®šã‚’é©ç”¨
    function applySettingsToCurrentPage() {
      const config = {
        enabled: zettelkastenEnabled.checked,
        visualMode: zettelkastenMode.value,
        autoLinkKeywords: autolinkKeywords.checked,
        highlightBidirectional: highlightBidirectional.checked,
        showBacklinks: showBacklinks.checked,
        keywordMinLength: parseInt(keywordMinLength.value, 10),
        markdownLinks: markdownLinks.checked,
        contextAwareness: contextAwareness.checked,
        atomicNoteSize: atomicNoteSize.value,
        autoSuggestLinks: autoSuggestLinks.checked,
        tagHierarchy: tagHierarchy.checked,
        smartBacklinks: smartBacklinks.checked,
        graphVisualization: graphVisualization.checked
      };
      
      // ãƒãƒƒã‚¯ãƒªãƒ³ã‚¯ã®è¡¨ç¤º/éè¡¨ç¤º
      const backlinksContainer = document.querySelector('.backlinks-container');
      if (backlinksContainer) {
        backlinksContainer.style.display = config.showBacklinks ? 'block' : 'none';
      }
      
      // åŒæ–¹å‘ãƒªãƒ³ã‚¯ã®å¼·èª¿è¡¨ç¤º
      const bidirectionalLinks = document.querySelectorAll('.wiki-link.bidirectional');
      bidirectionalLinks.forEach(link => {
        if (config.highlightBidirectional) {
          link.style.borderBottom = '2px solid var(--color-success, #0fa968)';
          link.style.color = 'var(--color-success, #0fa968)';
          link.style.fontWeight = '500';
        } else {
          link.style.borderBottom = '1px dashed var(--color-primary, #4f6df5)';
          link.style.color = 'var(--color-primary, #4f6df5)';
          link.style.fontWeight = 'normal';
        }
      });
      
      // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆèªè­˜ã‚³ãƒ³ãƒ†ãƒŠã®è¡¨ç¤º/éè¡¨ç¤º
      const contextContainer = document.querySelector('.context-container');
      if (contextContainer) {
        contextContainer.style.display = config.contextAwareness ? 'block' : 'none';
      }
      
      // ã‚°ãƒ©ãƒ•ã®è¡¨ç¤º/éè¡¨ç¤º
      const graphContainer = document.querySelector('.knowledge-graph-container');
      if (graphContainer) {
        graphContainer.style.display = config.graphVisualization ? 'block' : 'none';
      }
      
      // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸãƒãƒ¼ãƒˆã‚¹ã‚¿ã‚¤ãƒ«
      const contentContainer = document.querySelector('.wiki-content');
      if (contentContainer) {
        // ãƒ¢ãƒ¼ãƒ‰ã”ã¨ã®ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
        contentContainer.classList.remove('mode-standard', 'mode-atomic', 'mode-hierarchical');
        contentContainer.classList.add(`mode-${config.visualMode}`);
      }
      
      // ã‚¹ãƒãƒ¼ãƒˆãƒãƒƒã‚¯ãƒªãƒ³ã‚¯
      const backlinkContexts = document.querySelectorAll('.backlink-context');
      backlinkContexts.forEach(context => {
        context.style.display = config.smartBacklinks ? 'block' : 'none';
      });
      
      console.log('Applied settings to current page');
    }
    
    // ãƒ†ãƒ¼ãƒãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ãƒ­ãƒ¼ãƒ‰ã‚’è©¦ã¿ã‚‹
    loadThemeManager();
    
    // è¨­å®šãƒ‘ãƒãƒ«ãŒé–‹ã‹ã‚ŒãŸã¨ãã«è¨­å®šã‚’èª­ã¿è¾¼ã‚€
    window.addEventListener('settings-panel-open', loadSettings);
    
    // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚‚è¨­å®šã‚’èª­ã¿è¾¼ã‚€
    loadSettings();
  });
</script>
